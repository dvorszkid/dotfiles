#!/bin/sh

# Weex script to use working dir as a weex dir.
# You will need a ./.weex/weexrc file that contains the configuration,
# and a ./.weex/targets that contains the targets to auto include when invoking weex.
# GL HF. d347h 2013.12.14.

WEEX_SRC="$(pwd)/.weex"
WEEX_DST="$HOME/.weex"

if [ -L $WEEX_DST ]; then
	rm $WEEX_DST
fi

if [ -e $WEEX_DST ]; then
	echo $WEEX_DST exists and its not a symlink. Exiting...
	exit
fi

if [ ! -e $WEEX_SRC ]; then
	echo You are not in a weexable directory, $WEEX_SRC does not exist. Exiting...
	exit
fi

# to surpress a weex warning
chmod 600 "$WEEX_SRC"/weexrc

# make this weex dir as current
echo Updating weex config dir...
ln -s "$WEEX_SRC" "$WEEX_DST"

# read targets
WEEX_TARGETS=$(cat $HOME/.weex/targets)
echo Found targets: $WEEX_TARGETS

# actual weex command
weex "$@" $WEEX_TARGETS
