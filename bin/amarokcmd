#!/bin/bash
# d347h's command line amaroK control script

# Variables
DBUS=`which dbus-send`
ACT=$1
OPTS="--type=method_call --dest=org.kde.amarok /Player org.freedesktop.MediaPlayer."

# DBus init
function init {
	if [[ -n "${SSH_CLIENT}" ]] && [[ -z "${DBUS_SESSION_BUS_ADDRESS}" ]]; then
		export DBUS_SESSION_BUS_ADDRESS=`cat /proc/$(pidof kded4)/environ | tr '\0' '\n' | grep DBUS_SESSION_BUS_ADDRESS | cut -d '=' -f2-`
	fi
}

function control {
	$DBUS $OPTS$ACT
}

# Help
function usage {
	echo "Command Line AmaroK control script"
	echo
	echo "amarokcmd"
	echo "           Play - starts playing"
	echo "           Pause - play/pause"
	echo "           Stop - stops current track"
	echo "           Next - jump to next track"
	echo "           Prev - jump to previous track"
	echo "           Quit - exit amaroK"
	echo
}

# main
if [[ -n "${ACT}" ]]; then
	init
	control
else
	usage
fi
